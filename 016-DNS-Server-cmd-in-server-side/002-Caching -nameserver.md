# ğŸ§  Caching Nameserver Setup
## ğŸ·ï¸ Update Hostname

### ğŸ” Display Current Hostname
```bash
hostname
```

### âœï¸ Set New Hostname
```bash
vim /etc/hostname
```
```bash
ns1.armour.local
```

### ğŸ”„ Reboot the System
```bash
reboot
```

### âœ… Confirm Hostname Change
```bash
hostname
```

---

## ğŸ“ Check DNS Resolver Configuration

### ğŸ“„ View `/etc/resolv.conf`
```bash
cat /etc/resolv.conf
```
```bash
# Generated by NetworkManager
search armour.local
nameserver 8.8.8.8
```
---
## ğŸ› ï¸ Install and Configure BIND (Berkeley Internet Name Domain)

### ğŸ“¦ Check if BIND is Installed
```bash
rpm -qa | grep bind
```

---

### ğŸ“¥ Install BIND and Utilities
```bash
yum install bind
```

---

### âœ… Verify Installation
```bash
rpm -qa | grep bind
```

---

### ğŸ“ƒ Get Information About the Installed Package
```bash
rpm -qi bind
```

---

### ğŸ“‚ List Installed Files
```bash
rpm -ql bind
```

---

### âš™ï¸ List Configuration Files
```bash
rpm -qc bind
```

---

### ğŸ—‚ï¸ Key Configuration File
```conf
/etc/named.conf
```
---
## ğŸ—‚ï¸ BIND Configuration Files Overview

---
## ğŸ“‚`named.conf`  
- Main configuration file for BIND.  
- Defines server options, zones, logging settings, access control lists (ACLs), and security policies.  
- Example configurations include:  
  - Which IP address and port to listen on. 
  - Allowed clients for DNS queries  
  - Path to zone files  

---

## ğŸ“‚`/etc/named.iscdlv.key`  
- Contains a TSIG (Transaction Signature) key for secure communication between DNS servers.  
- Used for:  
  - DNS dynamic updates  
  - Zone transfers between servers  
- Automatically generated and managed by BIND itself.

---

## ğŸ“‚`/etc/named.rfc1912.zones`  
- Contain the Configuration for default zones as defined by RFC 1912  
- Defines common zones:  
  - **localhost**  
  - **0.0.127.in-addr.arpa** (loopback reverse lookups)  
  - **255.in-addr.arpa**(broadcast reverse lookups)  
- Helps resolve local network issues and reverse DNS lookups  

---

## ğŸ“‚`/etc/named.root.key`  
- Holds the root trust anchor key for DNSSEC  
- Used to validate responses from root DNS servers  
- DNSSEC validation fails if this key is missing or outdated

---

## `/var/named`
This is the working directory for BIND, where zone files and cache data are stored.

## ğŸ“‚ `/var/named/data`
Contains BIND-generated data files:
- `cache_dump.db` â€“ Stores cached DNS records
- `named_stats.txt` â€“ Stores statistics
- `named.recursing` â€“ Logs recursive queries
- `named.secroots` â€“ Logs secure root key status

---

## ğŸ“‚ `/var/named/dynamic`
- Stores dynamically generated zone files for DNS updates
- Used when configuring dynamic DNS or allowing clients to update DNS records

---

## ğŸ“‚ `/var/named/data`
- Contains the list of root DNS servers
- Essential for resolving queries starting from the root
- Loaded into memory when BIND starts to seed the root server list

---

## ğŸ“‚ `/var/named/empty`
- Defines an empty zone for queries to unresponsive or non-existent zones
- Prevents unnecessary traffic to root servers from invalid queries

---

## ğŸ“‚ `/var/named/localhost`
- Defines the zone for `localhost` (127.0.0.1)
- Ensures the local machine can always resolve its own name

---

## ğŸ“‚ `/var/named/loopback`
- Used for reverse lookup of `127.0.0.1`
- Ensure that the lookback address can be resolved.

---
## ğŸ“ /var/named/slaves
- Stores zone files transferred from master DNS servers (used in slave/secondary setups)
- Supports redundancy and load balancing

**View root hints file:**
```bash
cat /var/named/named.ca
```

---

## **ğŸ”§ Manage BIND Service**

**Check service status:**
```bash
systemctl status named.service
```

**Start the service:**
```bash
systemctl start named.service
```

**Check open ports for named:**
```bash
netstat -ntulp | grep 53
```

---

## ğŸ§ª Test Using `dig`

**Test localhost resolution using `dig`:**
```bash
dig google.com @127.0.0.1
```

---
# ğŸŒ CentOS 7 â€“ Modify Network Interface Configuration

**Open the network interface configuration file:**
```bash
vim /etc/sysconfig/network-scripts/ifcfg-enp0s3
```

**Example Configuration:**
```bash
TYPE=Ethernet
BOOTPROTO=static
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=enp0s3
UUID=92a9b9e9-ddba-4e75-a061-3b0e0d8e0e1c
DEVICE=enp0s3
ONBOOT=yes
IPADDR=192.168.1.37
PREFIX=24
GATEWAY=192.168.1.1
DNS1=192.168.1.1
BROWSER_ONLY=no
```

---

## âš™ï¸ Modify Network : Manager Connection Configuration

**Edit the NetworkManager connection file:**
```bash
vim /etc/NetworkManager/system-connections/enp0s3.nmconnection
```
**File Path:** `/etc/NetworkManager/system-connections/enp0s3.nmconnection`

---
## Example:
```bash
[connection]
id=enp0s3
uuid=5dabelf1-79aa-3751-8ba8-b0f0d1871434
type=ethernet
autoconnect-priority=-999
interface-name=enp0s3
timestamp=1703811905

[ethernet]

[ipv4]
address1=192.168.1.31/24,192.168.1.1
address2=192.168.1.32/24
address3=192.168.1.33/24
address4=192.168.1.34/24
dns=127.0.0.1
method=manual

[ipv6]
addr-gen-mode=eui64
method=disabled

[proxy]
```

- Reboot the system
```bash
reboot
```
- Check the query resolve or not:
```bash
dig google.com
```
Showing to resolve using local host
```bash
;; SERVER: 127.0.0.1#53(127.0.0.1)
```
---
## Configure BIND `named.conf`

### Example:
```bash
vim /etc/named.conf
```
Update Content only Lines:
```bash
##Add More Server Ip's
listen-on port 53 { 127.0.0.1; 192.168.1.31; 192.168.1.41; 192.168.1.51; };
## allow network all client
allow-query     { localhost; 192.168.1.0/24; };
```
```bash
//
// named.conf
//
// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
// server as a caching only nameserver (as a localhost DNS resolver only).
//
// See /usr/share/doc/bind*/sample/ for example named configuration files.
//

options {
	listen-on port 53 { 127.0.0.1; 192.168.1.21; 192.168.1.22; 192.168.1.23; };
	listen-on-v6 port 53 { ::1; };
	directory 	"/var/named";
	dump-file 	"/var/named/data/cache_dump.db";
	statistics-file "/var/named/data/named_stats.txt";
	memstatistics-file "/var/named/data/named_mem_stats.txt";
	secroots-file	"/var/named/data/named.secroots";
	recursing-file	"/var/named/data/named.recursing";
	allow-query     { localhost; 192.168.1.0/24; };

	/* 
	 - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
	 - If you are building a RECURSIVE (caching) DNS server, you need to enable 
	   recursion. 
	 - If your recursive DNS server has a public IP address, you MUST enable access 
	   control to limit queries to your legitimate users. Failing to do so will
	   cause your server to become part of large scale DNS amplification 
	   attacks. Implementing BCP38 within your network would greatly
	   reduce such attack surface 
	*/
	recursion yes;

	dnssec-validation yes;

	managed-keys-directory "/var/named/dynamic";
	geoip-directory "/usr/share/GeoIP";

	pid-file "/run/named/named.pid";
	session-keyfile "/run/named/session.key";

	/* https://fedoraproject.org/wiki/Changes/CryptoPolicy */
	include "/etc/crypto-policies/back-ends/bind.config";
};

logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
};

zone "." IN {
	type hint;
	file "named.ca";
};

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";
```
- Restart the Service:
```bash
systemctl restart named.service
```
```bash
netstat -ntulp | grep 53
```
---
## Configure Firewall Rules (Firewalld)
- Allow DNS Traffic (TCP and UDP Port 53):
```bash
firewall-cmd --permanent --add-port=53/tcp
```

```bash
firewall-cmd --permanent --add-port=53/udp
```
```bash
firewall-cmd --reload
```
- This Will Permanently open both TCP and UDP port 53 for DNS queries.

check `other client` terminal:

```bash
dig facebook.com @192.168.1.21
# response
; <<>> DiG 9.20.11-4+b1-Debian <<>> facebook.com @192.168.1.21
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 20325
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 1232
; COOKIE: 3f5825538680ab9d0100000068fe284e93943cfbeb6820b1 (good)
;; QUESTION SECTION:
;facebook.com.			IN	A

;; ANSWER SECTION:
facebook.com.		60	IN	A	163.70.143.35

;; Query time: 1368 msec
;; SERVER: 192.168.1.21#53(192.168.1.21) (UDP)
;; WHEN: Sun Oct 26 19:25:26 IST 2025
;; MSG SIZE  rcvd: 85
```
---

## Define `ACL` in `named.conf`

```bash
vim /etc/named.conf
```
**Edit Content:**
```bash
acl ns_ip_add {
	127.0.0.1;
	192.168.1.31;
	192.168.1.41;
	192.168.1.51;
};

acl mynetwork {
	127.0.0.1;
	192.168.1.0/24;
};

#In Options
listen-on port 53 { ns_ip_add; };
allow-query     { localhost; mynetwork; };
```

Example:
```bash
//
// named.conf
//
// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
// server as a caching only nameserver (as a localhost DNS resolver only).
//
// See /usr/share/doc/bind*/sample/ for example named configuration files.
//
acl ns_ip_add {
	127.0.0.1;
	192.168.1.21;
	192.168.1.22;
	192.168.1.23;
	192.168.1.24;
};

acl mynetwork {
	127.0.0.1;
	192.168.1.0/24;
};

options {
	listen-on port 53 { ns_ip_add; };
	listen-on-v6 port 53 { ::1; };
	directory 	"/var/named";
	dump-file 	"/var/named/data/cache_dump.db";
	statistics-file "/var/named/data/named_stats.txt";
	memstatistics-file "/var/named/data/named_mem_stats.txt";
	secroots-file	"/var/named/data/named.secroots";
	recursing-file	"/var/named/data/named.recursing";
	allow-query     { localhost; mynetwork; };

	/* 
	 - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
	 - If you are building a RECURSIVE (caching) DNS server, you need to enable 
	   recursion. 
	 - If your recursive DNS server has a public IP address, you MUST enable access 
	   control to limit queries to your legitimate users. Failing to do so will
	   cause your server to become part of large scale DNS amplification 
	   attacks. Implementing BCP38 within your network would greatly
	   reduce such attack surface 
	*/
	recursion yes;

	dnssec-validation yes;

	managed-keys-directory "/var/named/dynamic";
	geoip-directory "/usr/share/GeoIP";

	pid-file "/run/named/named.pid";
	session-keyfile "/run/named/session.key";

	/* https://fedoraproject.org/wiki/Changes/CryptoPolicy */
	include "/etc/crypto-policies/back-ends/bind.config";
};

logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
};

zone "." IN {
	type hint;
	file "named.ca";
};

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";
```
- Restart the Service
```bash
systemctl restart named.service
```

- Restart Firewall
```bash
systemctl restart firewalld.service
```

- Check other Pc to Name resolve:
```bash
dig google.com @192.168.1.51
```